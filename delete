#!/bin/bash
set -euo pipefail

BUCKET_FILE="bucket_list.txt"

while IFS= read -r bucket || [ -n "$bucket" ]; do
  bucket=$(echo "$bucket" | sed 's/\r//g' | xargs)

  [[ -z "$bucket" ]] && continue

  echo "ðŸ”’ Enabling BPA on: [$bucket]"

  aws s3api put-public-access-block \
    --bucket "$bucket" \
    --public-access-block-configuration \
      BlockPublicAcls=true,IgnorePublicAcls=true,BlockPublicPolicy=true,RestrictPublicBuckets=true

done < "$BUCKET_FILE"
